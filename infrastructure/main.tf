{"resource \"aws_amplify_app\" \"frontend_app\" {\n  name       = var.app_name\n  repository = var.repository\n\n  access_token             = var.access_token\n  enable_branch_auto_build = true\n\n  build_spec = <<-EOT\n    version: 1\n    frontend:\n      phases:\n        preBuild:\n          commands:\n            - npm ci\n        build:\n          commands:\n            - npm run build\n      artifacts:\n        baseDirectory: .next\n        files:\n          - '**/*'\n      cache:\n        paths:\n          - node_modules/**/*\n          - .next/cache/**/*\n  EOT\n\n  custom_rule {\n    source = "/<*>"\n    status = \"404\"\n    target = \"/index.html\"\n  }\n}\n\nresource \"aws_amplify_branch\" \"main\" {\n  app_id      = aws_amplify_app.frontend_app.id\n  branch_name = var.branch_name\n}\n\nresource \"aws_amplify_domain_association\" \"domain\" {\n  app_id      = aws_amplify_app.frontend_app.id\n  domain_name = var.domain_name\n\n  sub_domain {\n    branch_name = aws_amplify_branch.main.branch_name\n    prefix      = \"\"\n  }\n}\n"